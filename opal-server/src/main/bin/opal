#!/bin/sh

if [ -z "$JAVA_OPTS" ]
then
  # Set default JAVA_OPTS
  JAVA_OPTS="-Xmx512M"
fi

echo "JAVA_HOME=$JAVA_HOME"
echo "JAVA_OPTS=$JAVA_OPTS"
echo "OPAL_HOME=$OPAL_HOME"

if [ -z "$JAVA_HOME" ]
then
  echo "JAVA_HOME not set."
  exit 1;
fi

if [ -z "$OPAL_HOME" ]
then
  echo "OPAL_HOME not set."
  exit 2;
fi

# Are we under cygwin environment ?
WINDOWS=`echo $OS | grep -ci windows`

CLASSPATH=$OPAL_HOME/conf
for f in $(ls "$OPAL_HOME/lib" | grep jar$); do
  if [ x"$WINDOWS" = x0 ]
  then
    CLASSPATH=$CLASSPATH:$OPAL_HOME/lib/$f
  else
    CLASSPATH=$CLASSPATH\;$OPAL_HOME/lib/$f
  fi
done

[ -e $OPAL_HOME/logs ] || mkdir $OPAL_HOME/logs
java $JAVA_OPTS -cp "$CLASSPATH" -DOPAL_HOME="${OPAL_HOME}" org.obiba.opal.server.OpalServer $@ 2> "${OPAL_HOME}"/logs/opal-session.log
